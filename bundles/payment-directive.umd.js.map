{
  "version": 3,
  "file": "payment-directive.umd.js",
  "sources": [
    "ng://payment-directive/out/src/app/payment/payment-request.module.ts",
    "ng://payment-directive/out/src/app/payment/payemnt-request.directive.ts"
  ],
  "sourcesContent": [
    "import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport {PaymentRequestDirective} from \"./payemnt-request.directive\";\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  declarations: [PaymentRequestDirective],\n  exports: [PaymentRequestDirective]\n})\nexport class PaymentRequestModule { }\n",
    "import {\n  Directive, ElementRef, EventEmitter, HostListener, Input, Output, Renderer2\n} from '@angular/core';\nimport {PaymentOptions} from './payment-models';\n\n@Directive({\n  selector: '[appPaymentRequest]'\n})\nexport class PaymentRequestDirective {\n  @Input('options') options: PaymentOptions = {};\n  @Input('items') items: PaymentItem[];\n  @Input('shippingOptions') shippingOptions : any[];\n  @Output() onCheckout = new EventEmitter();\n  @Output() onShippingOptionChange = new EventEmitter();\n  payment: PaymentRequest;\n  constructor(private el: ElementRef, private renderer: Renderer2) {\n   if(this.isPaymentSupported()) {\n     this.items = [];\n     this.options = Object.assign({}, this.options, {\n       supportedPaymentMethods: [{supportedMethods: 'basic-card'}],\n       paymentDetails: {\n         total: {\n           label: 'Total',\n           amount: {\n             currency: 'USD',\n             value: 0\n           }\n         },\n         shippingOptions: this.shippingOptions,\n         displayItems: this.items\n       },\n       payerOptions: {}\n     });\n\n     this.updatePayment();\n   }  else {\n     this.renderer.setAttribute(this.el.nativeElement, 'disabled', 'true');\n   }\n\n  }\n\n  /**\n   * Update native payment request object.\n   */\n  updatePayment(): void {\n    this.options.paymentDetails.displayItems = this.items;\n    let total = 0;\n    this.items.forEach((item)=> {\n      total =+ parseFloat(<string>item.amount.value);\n    });\n    this.options.paymentDetails.total.amount.value = <any>total;\n    this.payment = new PaymentRequest(this.options.supportedPaymentMethods, this.options.paymentDetails, this.options.payerOptions);\n    this.handleShippingChangeEvent();\n  }\n\n  /**\n   * Trigger Payment request native popup\n   */\n  checkout(): void {\n    this.updatePayment();\n    this.payment.show().then((paymentResponse: PaymentResponse)=> {\n      paymentResponse.complete();\n      this.onCheckout.emit(paymentResponse);\n    }).catch((err)=> {\n      this.onCheckout.emit({\n        error: err,\n        success: false\n      });\n    })\n\n  }\n\n  /**\n   * Handle shipping option change event.\n   */\n  handleShippingChangeEvent(): void {\n    this.payment.addEventListener('shippingoptionchange', (event)=> {\n    const paymentRequest = event.target;\n    const selectedId = (<any>paymentRequest).shippingOption;\n    let res: {shippingOption?: any, total?: any} = {};\n    this.options.paymentDetails.shippingOptions.forEach((shippingOption)=> {\n      if(shippingOption.id === selectedId) {\n        shippingOption.selected = true;\n        this.options.paymentDetails.total.amount.value = <any>(parseFloat(this.options.paymentDetails.total.amount.value) + parseFloat(shippingOption.amount.value));\n        res.shippingOption = shippingOption;\n        res.total = this.options.paymentDetails.total.amount.value;\n      }\n    });\n      (<any>event).updateWith(new Promise((resolve)=> {\n      //return updated total value and selected shipping option.\n      this.onShippingOptionChange.emit(res);\n      resolve(this.options.paymentDetails);\n    }));\n    });\n  }\n\n  @HostListener('click', ['$event']) onClick($event){\n    if(this.isPaymentSupported) {\n      this.checkout();\n    }\n  }\n\n  isPaymentSupported(): boolean {\n    return !!(<any>window).PaymentRequest;\n  }\n\n}\n"
  ],
  "names": [
    "CommonModule",
    "NgModule",
    "HostListener",
    "Output",
    "Input",
    "Renderer2",
    "ElementRef",
    "Directive",
    "EventEmitter"
  ],
  "mappings": "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"
}
